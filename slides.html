<slide class='cover'>
<h1>Streamline your dev env with Docker <span>Giacomo Bagnoli, #RUBYDAY2014</span></h1>
</slide>

<slide markdown>
  ## `whoami`

  Started exploring cgroups in 2009. Used `lxc` with `pacemaker` in production in 2010-2012.

  Excited by docker since day 1. Experimenting from June 2014 , hit prod in August.

  Currently Backend Engineer at [Gild](http://www.gild.com)

  Previously at [Amazon](http://www.a9.com/) and [Asidev](https://twitter.com/asidev)


  * [Twitter: @gbagnoli](https://twitter.com/gbagnoli)
  * [Github: gbagnoli](https://github.com/gbagnoli)
  * [Facebook: giacomo.bagnoli](https://www.facebook.com/giacomo.bagnoli)
</slide>

<slide>
  <h2>What's wrong with my dev environment?</h2>
  <p>Nothing in particular. It's <strong>not*</strong> broken, so let's fix it.</p>
  <img class="center media" src="images/streamline.png" alt="Streamline"/>
  <p class="light">* conditions apply</p>
</slide>

<slide bg-img="snowflakes.jpg" credits="https://www.flickr.com/photos/amagill/4223790595/">
  <h2>What's wrong with my dev environment?</h2>
  <p>Youd development environment is probably</p>
  <p>a beautiful, unique <strong>snowflake</strong></p>
</slide>

<slide>
  <h2>What's Docker, anyway?!?</h2>

  <p>Open source platform</p>
  <img class="center media fright" src='images/docker.png' alt='Docker logo'/>
  <ul>
    <li>Docker Engine</li>

      <ul>
        <li>Container management runtime</li>
        <li>Packaging tools for images</li>
      </ul>

    <li>Docker Hub</li>
  </ul>
</slide>

<slide>
  <h2>Containers, uh?</h2>
  <img class="center media fright" src='images/containers.jpg' alt='Containers'/>

  <ul>
    <li>Operating system-level virtualization*</li>
    <li>runs multiple isolated <strong>linux</strong> systems</li>
    <li>on a single host, with a single kernel.</li>
    <li>no <code class="inline">/sbin/init</code>, no device emulation</li>
    <li>Think them as <code class="inline">chroot</code> on steroids</li>
  </ul>

  <p>&nbsp;</p>

  <ul>
    <li>Isolation provided by linux <code class="inline">cgroups</code> and <code class="inline">namespaces</code></li>
    <li>Resource limiting and prioritization via <code class="inline">cgroups</code></li>
    <li>Resource usage accounting via <code class="inline">cgroups</code></li>
  </ul>

  <p>&nbsp;</p>
  <p class="light">* not a virtualization method, containers != VM</p>
</slide>

<slide>
  <h2>Docker Images</h2>
  <img class="center media fright" src='images/docker-images.png' alt='Docker Images'/>
  <p>
    <em>Portable</em>, <strong>read-only</strong> layers.
  </p>
  <p>
    Images are composed at run-time to form the container root FS using an union filesystem.
  </p>
  <p>
    Processes tricked to see the filesystem as R/W.
  </p>
  <p>
    The writable layer is discarded if the container is not <strong>committed</strong>.
  </p>
  <p>
    The read-only and portable properties are <strong>important</strong> as they
    enable sharing (via the docker hub)
  </p>
</slide>

<slide>
  <h2>Docker Images (2)</h2>
  <img class="center media fright" src='images/docker-dag.png' alt='Docker DAG'/>
  <p>
    Docker images form a <strong>D</strong>irect <strong>A</strong>cyclic <strong>G</strong>raph
  </p>
  <p>
    Each layer is cached (possibly) reused by other images.
  </p>
  <p>
    This means that if multiple images derive from <code class='inline'>debian:wheezy</code>
    that particular image is shared by all of them (thus downloaded once)
  </p>
  <p>
     Images are pushed/pull to/from the docker hub.
  </p>
</slide>

<slide>
  <h2>Docker Images (3)</h2>
  <code hljs>
$ docker images
REPOSITORY                TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
redis                     2.8.13              dd52dc9c8f76        9 minutes ago       98.44 MB
mongo                     2.6.4               dd1f260c0731        12 minutes ago      391.2 MB
debian                    wheezy              9cdcc6025135        18 hours ago        85.19 MB
ubuntu                    14.04               96864a7d2df3        2 days ago          204.4 MB
ubuntu                    12.04               ec966722cde4        2 days ago          103.8 MB
  </code>
</slide>

<slide>
  <h2>Docker Images (4)</h2>
  <code hljs>
$ docker images --tree
└─511136ea3c5a Virtual Size: 0 B
  └─b37448882294 Virtual Size: 85.19 MB
    └─9cdcc6025135 Virtual Size: 85.19 MB Tags: debian:wheezy
      ├─e365f7cdb352 Virtual Size: 85.52 MB
      │ └─b15940870e43 Virtual Size: 85.52 MB

      │             └─22ad4fc6b16f Virtual Size: 98.44 MB
      │               └─bd1e22dd175d Virtual Size: 98.44 MB
      │                 └─3b1ce200fdad Virtual Size: 98.44 MB
      │                   └─dd52dc9c8f76 Virtual Size: 98.44 MB Tags: redis:2.8.13
      └─49fd1ae472a8 Virtual Size: 85.52 MB
        └─6c203838fd07 Virtual Size: 99.62 MB
          └─caca6ab42532 Virtual Size: 101.7 MB
            └─aa66fe9fc23c Virtual Size: 101.8 MB

                      └─b1cd74f30329 Virtual Size: 391.2 MB
                        └─9d0a3438646f Virtual Size: 391.2 MB
                          └─dd1f260c0731 Virtual Size: 391.2 MB Tags: mongo:2.6.4
  </code>
</slide>

<slide>
  <h2>Let's build a ruby2 image</h2>
<p>
  Ubuntu 14.04 image has no ruby at all. Repos have ruby 1.9
</p>

<p>Dockerfile:</p>
<pre>
FROM       ubuntu:14.04
MAINTAINER Giacomo Bagnoli &lt;gbagnoli@gmail.com&gt;

RUN echo "deb http://ppa.launchpad.net/brightbox/ruby-ng/ubuntu trusty main" > \
    /etc/apt/sources.list.d/ruby-ng.list
RUN apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys C3173AA6
RUN apt-get update
RUN apt-get install -y ruby2.1
</pre>

Build!
<pre>
$ docker build --rm -t rubyday/ruby:2.1 .
</pre>
</slide>

<slide>
  <h2>Ruby2 image</h2>
  <p>
    Each directive in the <code class="inline">Dockerfile</code> adds a layer
  </p>
  <pre>
$ docker images --tree

└─96864a7d2df3 Virtual Size: 204.4 MB Tags: ubuntu:14.04
  └─8f1b6341c5be Virtual Size: 204.4 MB                                   # MAINTAINER
    └─d323cc59da91 Virtual Size: 204.4 MB                                 # RUN
      └─724a6664d97a Virtual Size: 204.4 MB                               # RUN
        └─8614dab05fbe Virtual Size: 224.8 MB                             # RUN
          └─d7ae4a198781 Virtual Size: 257.2 MB Tags: rubyday/ruby:2.1    # RUN
  </pre>

  <pre>
$ docker run -t rubyday/ruby:2.1 ruby -v
ruby 2.1.2p95 (2014-05-08 revision 45877) [x86_64-linux-gnu]
  </pre>

  <p>
    Woah, 53Mb. <code class='inline'>apt-get update</code> adds 20Mb to the image.
  </p>
</slide>

<slide>
  <h2>Ruby2 image (2)</h2>
  <p>
    Let's remove apt-get files by adding another RUN statement
  </p>
  <pre>
diff --git a/ruby2/Dockerfile b/ruby2/Dockerfile
index dd37dcb..2b9c105 100644
--- a/ruby2/Dockerfile
+++ b/ruby2/Dockerfile
@@ -8,3 +8,4 @@ RUN echo "deb http://ppa.launchpad.net/brightbox/ruby-ng/ubuntu trusty main" > /
 RUN apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys C3173AA6
 RUN apt-get update
 RUN apt-get install -y ruby2.1
+RUN rm -rf /var/lib/apt/lists/* /var/cache/apt/archives/*.deb
  </pre>

  <p>
    Rebuild... and....
  </p>
</slide>

<slide>
  <h2>Ruby2 Image (3)</h2>
  <pre>
$ docker images --tree

└─96864a7d2df3 Virtual Size: 204.4 MB Tags: ubuntu:14.04
  └─8f1b6341c5be Virtual Size: 204.4 MB                                   # MAINTAINER
    └─d323cc59da91 Virtual Size: 204.4 MB                                 # RUN
      └─724a6664d97a Virtual Size: 204.4 MB                               # RUN
        └─8614dab05fbe Virtual Size: 224.8 MB                             # RUN
          └─d7ae4a198781 Virtual Size: 257.2 MB                           # RUN
            └─b8bb3ce3008e Virtual Size: 257.2 MB Tags: rubyday/ruby:2.1  # RUN
  </pre>
  <p class="big">
    WHAT?
  </p>

  <p>
    Remember that every directive adds a layer. Layers are read only.
  </p>
</slide>

<slide>
  <h2>Dockerfile</h2>
  <pre>
FROM       ubuntu:14.04
MAINTAINER Giacomo Bagnoli &lt;gbagnoli@gmail.com&gt;

RUN echo "deb http://ppa.launchpad.net/brightbox/ruby-ng/ubuntu trusty main" \
    &gt; /etc/apt/sources.list.d/ruby-ng.list && \
    apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys C3173AA6 && \
    apt-get update && \
    apt-get install -y ruby2.1 && \
    rm -rf /var/lib/apt/lists/* /var/cache/apt/archives/*.deb
  </pre>
</slide>

<slide>
  <h2>Rebuild</h2>
  Build:
  <pre>
$ docker build --rm -t rubyday/ruby:2.1 .
  </pre>

  <pre>
$ docker images
REPOSITORY           TAG        IMAGE ID            CREATED             VIRTUAL SIZE
rubyday/ruby         2.1        b337a5c538f3        About a minute ago  236.9 MB
  </pre>

  <pre>
└─96864a7d2df3 Virtual Size: 204.4 MB Tags: ubuntu:14.04
  └─86ae939e2da3 Virtual Size: 204.4 MB                         # MAINTAINER
    └─b337a5c538f3 Virtual Size: 236.9 MB Tags: gild/ruby:2.1   # RUN
  </pre>
</slide>
<!--
<slide>
  <h2>Why another presentation framework?</h2>
  <p>There are plenty of presentation frameworks made with HTML, CSS and Javascript around. So why we need another one?</p>
  <p>We probably don't. I've started this project just because I wanted to improve my Angular JS skills.</p>
  <blockquote><code class="inline">blockquote</code> Lorem ipsum dolor sit amet, consectetur adipisicing elit</blockquote>
</slide>

<slide>
  <h2>Presenter mode</h2>
  <table>
    <tr>
      <th>Normal view</th>
      <th>Presenter mode</th>
    </tr>
    <tr>
      <td><img src="images/slide-single.gif" alt=""/></td>
      <td><img src="images/slide-presenter.gif" alt=""/></td>
    </tr>
  </table>
  <p>In presenter mode, you can see the current and the upcoming slide.</p>
  <p>To enter presenter mode, you just need to attach <code class="inline">?preview</code> in your URL. <a href="?preview">Try it out!</a></p>
  <p>Slides are synchronized between tabs.</p>
</slide>

<slide>
  <h2>Code highlighting</h2>
  <div hljs>
# Variables and expressions.
a = 10
b = 3 * a + 2
printf("%d %d\n", a, b);

# Type is dynamic.
b = "A string"
c = 'Another String'
print b + " and " + c + "\n"
  </div>
  <p>You just need to add the "hljs" attribute to your element: <code class="inline">&lt;div <strong>hljs</strong>&gt;your code here&lt;/div&gt;</code></p>
</slide>

<slide markdown>
  ##Markdown content

  write your slide in markdown if you like it

- list item **one**
- list item *two*

Add the "markdown" attribute to the slide element `<code class="inline">&lt;slide <strong>markdown</strong>&gt;</code>`
</slide>

<slide bg-img="oscar.jpg" credits="TIME & LIFE Pictures http://life.time.com/?attachment_id=11373">
  <h2 class="left">Auto fitting images</h2>
  <p class="light-text">Add the "bg-img" attribute to your slide element:<br><code class="inline">&lt;slide <strong>bg-img</strong>="path/to/image"&gt;</code><br>without worrying about the image size.</p>
  <p class="light-text">You can add credits too (with autolink)<br><code class="inline">&lt;slide bg.img="..." <strong>credits</strong>="..."&gt;</code></p>
</slide>

<slide>
  <h3 class="abs-center">Add<br>class="abs-center"<br>to an item to center it</h3>
</slide>

<slide>
  <h1>Do you like that?</h1>
  <img class="center media" src="images/slow-clap.gif" alt=""/>
  <p class="center">Follow me on twitter <a href="https://twitter.com/granze">@granze</a></p>
</slide>
-->
